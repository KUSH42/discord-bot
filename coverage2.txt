
> discord-content-announcement-bot@0.2.0 test:coverage
> NODE_OPTIONS="--experimental-vm-modules" jest --coverage --verbose=true

 [ERROR]: Error stopping bot application: Bot stop failed
Error: Bot stop failed
    at Object.<anonymous> (/home/xush/Documents/prog/discord-youtube-bot/tests/integration/startup-shutdown.test.js:285:52)
    at Promise.finally.completed (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at _runTest (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-runner/build/index.js:275:16)
    at runTest (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-runner/build/index.js:343:7)
 [ERROR]: Graceful shutdown completed with errors
 [ERROR]: Error disposing container: Container disposal failed
Error: Container disposal failed
    at Object.<anonymous> (/home/xush/Documents/prog/discord-youtube-bot/tests/integration/startup-shutdown.test.js:311:58)
    at Promise.finally.completed (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at _runTest (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-runner/build/index.js:275:16)
    at runTest (/home/xush/Documents/prog/discord-youtube-bot/node_modules/jest-runner/build/index.js:343:7)
 [ERROR]: Graceful shutdown completed with errors
[DiscordClientService] [INFO]: Creating new Discord client instance
[DiscordClientService] [INFO]: Discord client created with instance ID: 1753624107989
[DebugFlagManager] [INFO]: DebugFlagManager initialized
[DiscordClientService] [WARN]: Discord client is not available for destruction
[DiscordClientService] [INFO]: Creating new Discord client instance
[DiscordClientService] [INFO]: Discord client created with instance ID: 1753624108017
[DebugFlagManager] [INFO]: DebugFlagManager initialized
[DiscordClientService] [WARN]: Discord client is not available for destruction
[DiscordClientService] [INFO]: Creating new Discord client instance
[DiscordClientService] [INFO]: Discord client created with instance ID: 1753624108040
[DiscordClientService] [WARN]: Discord client is not available for destruction
[DiscordClientService] [INFO]: Creating new Discord client instance
[DiscordClientService] [INFO]: Discord client created with instance ID: 1753624108060
[DebugFlagManager] [INFO]: DebugFlagManager initialized
[DiscordClientService] [WARN]: Discord client is not available for destruction
[DiscordClientService] [INFO]: Creating new Discord client instance
[DiscordClientService] [INFO]: Discord client created with instance ID: 1753624108074
[DebugFlagManager] [INFO]: DebugFlagManager initialized
[DiscordClientService] [WARN]: Discord client is not available for destruction
[DiscordClientService] [INFO]: Creating new Discord client instance
[DiscordClientService] [INFO]: Discord client created with instance ID: 1753624108086
[DebugFlagManager] [INFO]: DebugFlagManager initialized
[DiscordClientService] [WARN]: Discord client is not available for destruction
[DiscordClientService] [INFO]: Creating new Discord client instance
[DiscordClientService] [INFO]: Discord client created with instance ID: 1753624108116
[DebugFlagManager] [INFO]: DebugFlagManager initialized
[ScraperApplication] [ERROR]: Failed to initialize browser
Error: Browser launch failed
    at Object.<anonymous> (/home/xush/Documents/prog/discord-youtube-bot/tests/integration/production-setup-validation.test.js:290:61)
[ScraperApplication] [ERROR]: Failed to start scraper application
Error: Browser launch failed
    at Object.<anonymous> (/home/xush/Documents/prog/discord-youtube-bot/tests/integration/production-setup-validation.test.js:290:61)
[DiscordClientService] [WARN]: Discord client is not available for destruction
[DiscordClientService] [INFO]: Creating new Discord client instance
[DiscordClientService] [INFO]: Discord client created with instance ID: 1753624108134
[DebugFlagManager] [INFO]: DebugFlagManager initialized
[DiscordClientService] [WARN]: Discord client is not available for destruction
[DiscordClientService] [INFO]: Creating new Discord client instance
[DiscordClientService] [INFO]: Discord client created with instance ID: 1753624108156
[DebugFlagManager] [INFO]: DebugFlagManager initialized
[DiscordClientService] [WARN]: Discord client is not available for destruction
[DiscordClientService] [INFO]: Creating new Discord client instance
[DiscordClientService] [INFO]: Discord client created with instance ID: 1753624108170
[DebugFlagManager] [INFO]: DebugFlagManager initialized
[DiscordClientService] [WARN]: Discord client is not available for destruction
[ContentStateManager] [INFO]: Content state manager initialized
[ContentStateManager] [INFO]: Content state manager initialized
[ContentStateManager] [INFO]: Content state manager initialized
[ContentStateManager] [INFO]: Content state manager initialized
[ContentStateManager] [INFO]: Content state manager initialized
[DiscordClientService] [INFO]: Creating new Discord client instance
[DiscordClientService] [INFO]: Discord client created with instance ID: 1753624159200
[DebugFlagManager] [INFO]: DebugFlagManager initialized
 [INFO]: Test log message
[ContentStateManager] [INFO]: Content state manager initialized
---------------------------------------------|---------|----------|---------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
File                                         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                                                                                             
---------------------------------------------|---------|----------|---------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
All files                                    |   77.99 |    88.35 |   86.19 |   77.99 |                                                                                                                                                                                                               
 src                                         |   37.59 |    84.89 |    81.7 |   37.59 |                                                                                                                                                                                                               
  config-validator.js                        |     100 |      100 |     100 |     100 |                                                                                                                                                                                                               
  discord-utils.js                           |   98.33 |    92.85 |     100 |   98.33 | 68-69                                                                                                                                                                                                         
  duplicate-detector.js                      |   90.05 |    86.88 |   90.62 |   90.05 | 25-26,48-49,70-72,80-81,121-122,154-155,318-335,341-355,459-460,500-501,514-518,561-562                                                                                                                       
  logger-utils.js                            |   79.16 |    74.46 |   84.21 |   79.16 | 34-39,45,60-61,66-67,78-80,87-91,98-102,110-111,116-117,126-127,131-132,140-141,150-151,166-176,186-187,198-199,204-205,210-211,257-269,289-290                                                               
  message-processor.js                       |       0 |        0 |       0 |       0 | 1-303                                                                                                                                                                                                         
  production-setup.js                        |       0 |        0 |       0 |       0 | 1-533                                                                                                                                                                                                         
  rate-limiter.js                            |   78.99 |      100 |   57.14 |   78.99 | 68-73,81-92,112-113,119-120,127-128,188-209                                                                                                                                                                   
  youtube-scraper-service.js                 |       0 |        0 |       0 |       0 | 1-1054                                                                                                                                                                                                        
 src/application                             |   84.28 |    85.52 |   89.25 |   84.28 |                                                                                                                                                                                                               
  auth-manager.js                            |   96.47 |    90.78 |     100 |   96.47 | 63-64,139,299-307,342-343                                                                                                                                                                                     
  bot-application.js                         |    82.7 |    73.55 |   85.29 |    82.7 | 214-219,230-235,257-261,265,270,275,291,369-375,379-383,393-396,400-401,440-447,451-457,491-492,497-502,510-513,522-524,539-543,545-546,740-741,852-853,904-913,942-945,993-994,1036-1147                     
  monitor-application.js                     |   96.32 |    89.63 |   96.87 |   96.32 | 163-165,463-484,756-758,833-834,866-873,905-906                                                                                                                                                               
  scraper-application.js                     |   74.52 |    91.89 |   83.72 |   74.52 | 181-223,231-232,240-259,273-278,286-325,332-357,365-366,438-440,513-519,529-545,597-598,602-603,627-628,757-897,913-919,969-971,1308-1310,1333-1334,1541-1600,1607-1636                                       
 src/config                                  |       0 |        0 |       0 |       0 |                                                                                                                                                                                                               
  content-detection.js                       |       0 |        0 |       0 |       0 | 1-242                                                                                                                                                                                                         
 src/core                                    |   94.32 |    93.31 |   96.92 |   94.32 |                                                                                                                                                                                                               
  command-processor.js                       |   92.82 |    88.04 |     100 |   92.82 | 185-189,217-221,238-243,249-250,259-260,266-267,275-276,282-283,369-377,382-383,732-737,770-771,790-795,828-833,841-846,885-890,929-930,950-955,989-994                                                       
  content-announcer.js                       |   86.98 |    94.55 |      85 |   86.98 | 99-106,200,202-203,332-334,539-541,568-582,589-597,606-650                                                                                                                                                    
  content-classifier.js                      |   98.92 |    97.12 |     100 |   98.92 | 332-337,361                                                                                                                                                                                                   
  content-coordinator.js                     |     100 |    95.14 |     100 |     100 | 297-298,311                                                                                                                                                                                                   
  content-state-manager.js                   |   94.41 |    97.18 |   94.73 |   94.41 | 67-74,238-254                                                                                                                                                                                                 
  livestream-state-machine.js                |   94.88 |    93.54 |     100 |   94.88 | 192-214                                                                                                                                                                                                       
 src/infrastructure                          |   95.15 |     93.8 |   95.23 |   95.15 |                                                                                                                                                                                                               
  configuration.js                           |   73.35 |    79.12 |   66.66 |   73.35 | 108-109,113-114,123-124,138-139,143-144,154-155,162-163,166-167,172-173,178-179,183-184,194-195,199-201,206-207,211-213,217-218,223-224,228-230,238-253,260-266,273-283,290-298,305-312,357-363               
  debug-flag-manager.js                      |   99.47 |    93.24 |     100 |   99.47 | 294-295                                                                                                                                                                                                       
  dependency-container.js                    |    99.1 |    98.36 |     100 |    99.1 | 86-87                                                                                                                                                                                                         
  event-bus.js                               |   99.26 |    98.43 |     100 |   99.26 | 239-240                                                                                                                                                                                                       
  metrics-manager.js                         |   98.93 |    95.65 |     100 |   98.93 | 154-155,287-288,467-468                                                                                                                                                                                       
  persistent-storage.js                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                               
  state-manager.js                           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                               
 src/services/implementations                |   77.07 |    84.25 |   64.42 |   77.07 |                                                                                                                                                                                                               
  discord-client-service.js                  |   92.96 |    80.76 |   85.71 |   92.96 | 20-22,62-64,247-249,255-262,268-269                                                                                                                                                                           
  fetch-http-service.js                      |   62.13 |    57.14 |   36.84 |   62.13 | 36-37,43-44,50-51,57-58,81,83,85-88,99-100,120-121,123-124,128-129,134-135,144-164,170-203,209-210,216-217,223-224,230-239,245-254,260-265,274-278,293                                                        
  playwright-browser-service.js              |    65.6 |    72.22 |      20 |    65.6 | 22-23,34-39,51-52,56-57,61-62,73-74,93-97,105-109,118-122,132-136,145-149,157-161,170-174,182-186,194-198,206-210,218-224,232-236,244-248,255-259,266-270,278-287,295-299,306-310,340-345                     
  youtube-api-service.js                     |   99.17 |    92.43 |     100 |   99.17 | 64-65,149-150                                                                                                                                                                                                 
  youtube-scraper-service.js                 |   71.28 |    85.71 |   90.47 |   71.28 | 186-187,192-193,204-216,269-270,280-281,285-336,381-383,413-415,448-450,479-480,496-498,530-541,546-548,554-651,654-656,719-720,726-728,746-766,805-806,841-842,847-865,978-987,1008-1019,1038-1048,1056-1085 
 src/services/implementations/message-sender |   81.22 |    78.57 |   78.21 |   81.22 |                                                                                                                                                                                                               
  discord-message-sender.js                  |   73.29 |    60.31 |   72.22 |   73.29 | 57-58,97-99,138-140,143-145,184-192,199-208,214-228,235-236,246-247,275-282,296-297,323-337,339-343,359-372,389-395,402-403,415,420,448-449,469-479,488-493,515-534,541-542                                   
  message-processor.js                       |   71.11 |    42.85 |   72.72 |   71.11 | 96-115,157-158,165-170,186-187,190-191,194-195,198-199,202-203,213-214,218-219,225-226,237-238,258-268,277-282,305-321,327-339,349-359                                                                        
  message-queue.js                           |     100 |       92 |     100 |     100 | 31,128                                                                                                                                                                                                        
  message.js                                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                               
  processing-scheduler.js                    |   61.04 |       50 |   33.33 |   61.04 | 39-40,50-51,59-60,76-77,93-107,116-133,142-154,163-164,183-192,200-208,228-231,239-240,246-249,256-264,271-280,287-298,304-312,335-343                                                                        
  rate-limiter.js                            |     100 |      100 |     100 |     100 |                                                                                                                                                                                                               
  retry-handler.js                           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                               
 src/utilities                               |   98.93 |     90.9 |   98.03 |   98.93 |                                                                                                                                                                                                               
  async-mutex.js                             |   97.22 |      100 |   83.33 |   97.22 | 70-71                                                                                                                                                                                                         
  browser-config.js                          |     100 |    95.45 |     100 |     100 | 90                                                                                                                                                                                                            
  enhanced-logger.js                         |   99.48 |    86.76 |     100 |   99.48 | 263-264                                                                                                                                                                                                       
  time-parser.js                             |   96.09 |    88.46 |     100 |   96.09 | 51-52,90,115-116                                                                                                                                                                                              
  utc-time.js                                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                               
 src/utils                                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                               
  delay.js                                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                               
---------------------------------------------|---------|----------|---------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
